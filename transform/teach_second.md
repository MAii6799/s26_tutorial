# è§†è§‰ç¬¬ä¸‰è¯¾ï¼ˆç¬¬äºŒéƒ¨åˆ†ï¼‰ï¼šå››å…ƒæ•°ç­‰ğŸ˜‰

authorï¼š[Cinjay Jiang](https://github.com/knot41)

dateï¼š2025/4/13

---

## ä¸€ã€ä»€ä¹ˆæ˜¯å››å…ƒæ•°ï¼ŸğŸ¤”

åœ¨ä¸Šä¸€éƒ¨åˆ†ï¼Œæˆ‘ä»¬è®²äº†æ—‹è½¬çŸ©é˜µæ˜¯å¦‚ä½•è¡¨ç¤º**å§¿æ€ï¼ˆæœå‘ï¼‰**çš„ã€‚å®ƒå¾ˆç›´è§‚ï¼Œä¹Ÿå¾ˆå¥½ç”¨â€”â€”ä½†æœ‰äº›**å°é—®é¢˜**ï¼Œå°±æ¯”å¦‚æ—‹è½¬çŸ©é˜µæ˜¯ $3\times3$ï¼Œæœ‰ 9 ä¸ªå…ƒç´ ï¼Œç„¶è€Œæœå‘æ„Ÿè§‰åªéœ€è¦ 3 ä¸ªè‡ªç”±åº¦ã€‚å››å…ƒæ•°èƒ½å¤Ÿè§£å†³æ—‹è½¬çŸ©é˜µç”¨9ä¸ªå…ƒç´ è¡¨ç¤ºä¸‰ä¸ªè‡ªç”±åº¦çš„å†—ä½™æƒ…å†µã€‚

### åŸºæœ¬æ€§è´¨

å››å…ƒæ•°æ˜¯ä¸€ç§æ‰©å±•äº†å¤æ•°çš„æ•°å­¦æ¦‚å¿µã€‚å››å…ƒæ•°çš„å®šä¹‰å¦‚ä¸‹ï¼š

$$
q = w + xi + yj + zk
$$

å…¶ä¸­ $w, x, y, z$ æ˜¯å®æ•°ï¼Œ$i, j, k$ æ˜¯è™šæ•°å•ä½ï¼Œæ»¡è¶³å¦‚ä¸‹å…³ç³»ï¼š

$$
i^2 = j^2 = k^2 = ijk = -1
$$

å››å…ƒæ•°çš„åŠ æ³•å’Œä¹˜æ³•å®šä¹‰å¦‚ä¸‹ï¼š

$$
q_1 + q_2 = (w_1 + w_2) + (x_1 + x_2)i + (y_1 + y_2)j + (z_1 + z_2)k
$$

$$
q_1 \cdot q_2 = (w_1w_2 - x_1x_2 - y_1y_2 - z_1z_2) + (w_1x_2 + x_1w_2 + y_1z_2 - z_1y_2)i + (w_1y_2 - x_1z_2 + y_1w_2 + z_1x_2)j + (w_1z_2 + x_1y_2 - y_1x_2 + z_1w_2)k
$$

å››å…ƒæ•°çš„æ¨¡å®šä¹‰å¦‚ä¸‹ï¼š

$$
|q| = \sqrt{w^2 + x^2 + y^2 + z^2}
$$

å››å…ƒæ•°çš„å…±è½­å®šä¹‰å¦‚ä¸‹ï¼š

$$
q^* = w - xi - yj - zk
$$

å››å…ƒæ•°çš„é€†å®šä¹‰å¦‚ä¸‹ï¼š

$$
q^{-1} = \frac{q^*}{|q|^2}
$$


### å››å…ƒæ•°è¡¨ç¤ºæ—‹è½¬

ä¸€ä¸ªå•ä½å››å…ƒæ•°ï¼ˆæ¨¡é•¿ä¸º1ï¼‰å¯ä»¥è¡¨ç¤º**ç»•ä»»æ„è½´æ—‹è½¬ä»»æ„è§’åº¦**ã€‚

æ¨¡é•¿ä¸ä¸º1çš„è¯ï¼Œæ—‹è½¬åçš„ç»“æœå‘é‡ä¼šè¢«**ç¼©æ”¾**ã€‚

å¦‚æœè¦ç»•å•ä½è½´ $\hat{\mathbf{n}} = [n_x, n_y, n_z]^T$ æ—‹è½¬è§’åº¦ $\theta$ï¼Œé‚£ä¹ˆå¯¹åº”çš„å››å…ƒæ•°æ˜¯ï¼š

$$
\mathbf{q} = \begin{bmatrix}
\cos(\theta/2) \\
n_x \cdot \sin(\theta/2) \\
n_y \cdot \sin(\theta/2) \\
n_z \cdot \sin(\theta/2)
\end{bmatrix}
$$

> æ³¨ï¼šæ˜¯ $\theta/2$ï¼Œä¸æ˜¯ $\theta$ ï¼Œåˆ«æé”™äº†ï¼

### å››å…ƒæ•°çš„ä½¿ç”¨

å››å…ƒæ•°çš„ä¸»è¦ç”¨é€”å°±æ˜¯ï¼š**æ—‹è½¬ç‚¹ã€è¡¨ç¤ºå§¿æ€**ç­‰ã€‚

#### æ—‹è½¬ä¸€ä¸ªå‘é‡ $\mathbf{v}$ï¼š

1. æŠŠå‘é‡ $\mathbf{v}$ å˜æˆå››å…ƒæ•°å½¢å¼ï¼š$\mathbf{v}_q = [0, v_x, v_y, v_z]$
2. ç”¨å››å…ƒæ•°æ—‹è½¬å®ƒï¼š

$$
\mathbf{v}' = \mathbf{q} \cdot \mathbf{v}_q \cdot \mathbf{q}^{-1}
$$

å…¶ä¸­ $\mathbf{q}^{-1}$ æ˜¯å››å…ƒæ•°çš„å…±è½­ï¼ˆå› ä¸ºå®ƒæ˜¯å•ä½å››å…ƒæ•°ï¼‰ï¼š

$$
\mathbf{q}^{-1} = \begin{bmatrix} w \\ -x \\ -y \\ -z \end{bmatrix}
$$

### å››å…ƒæ•°å’Œæ—‹è½¬çŸ©é˜µçš„ç›¸äº’è½¬åŒ–

æˆ‘ä»¬å¯ä»¥æŠŠå››å…ƒæ•°è½¬æˆæ—‹è½¬çŸ©é˜µï¼Œæˆ–è€…åè¿‡æ¥ã€‚

#### å››å…ƒæ•° â†’ æ—‹è½¬çŸ©é˜µï¼š

è®¾ $\mathbf{q} = [w, x, y, z]^T$ï¼Œåˆ™å¯¹åº”çš„æ—‹è½¬çŸ©é˜µä¸ºï¼š

$$
\mathbf{R} = \begin{bmatrix}
1 - 2(y^2 + z^2) & 2(xy - wz) & 2(xz + wy) \\
2(xy + wz) & 1 - 2(x^2 + z^2) & 2(yz - wx) \\
2(xz - wy) & 2(yz + wx) & 1 - 2(x^2 + y^2)
\end{bmatrix}
$$

ï¼ˆè™½ç„¶æœ‰ç‚¹å¤æ‚ï¼Œä½†å¯ä»¥äº¤ç»™åº“æ¥åšï¼ğŸ˜‹ï¼‰

#### æ—‹è½¬çŸ©é˜µ â†’ å››å…ƒæ•°ï¼š

è®¾æ—‹è½¬çŸ©é˜µä¸ºï¼š

$$
\mathbf{R} = \begin{bmatrix}
r_{11} & r_{12} & r_{13} \\
r_{21} & r_{22} & r_{23} \\
r_{31} & r_{32} & r_{33}
\end{bmatrix}
$$

æˆ‘ä»¬å…ˆè®¡ç®—ä¸€ä¸ª**è¿¹ï¼ˆTraceï¼‰**ï¼š

$$
\text{tr} = r_{11} + r_{22} + r_{33}
$$

ç„¶ååˆ¤æ–­ï¼š

- å¦‚æœ $\text{tr} > 0$ï¼š

  $$
  S = \sqrt{\text{tr} + 1.0} \cdot 2 \\
  w = 0.25 \cdot S \\
  x = \frac{r_{32} - r_{23}}{S} \\
  y = \frac{r_{13} - r_{31}}{S} \\
  z = \frac{r_{21} - r_{12}}{S}
  $$

- å¦åˆ™æ ¹æ®æœ€å¤§å¯¹è§’å…ƒç´ é€‰æ‹©è®¡ç®—æ–¹å¼ï¼ˆç•¥å¤æ‚ï¼Œä¸å±•å¼€ï¼‰

---

## äºŒã€ä»€ä¹ˆæ˜¯æ¬§æ‹‰è§’ï¼ŸğŸ¤”

- æˆ‘ä»¬åœ¨ç”Ÿæ´»ä¸­æè¿°æ—‹è½¬æ—¶å¸¸è¯´â€œå…ˆç»•Xè½´è½¬ä¸ªè§’åº¦ï¼Œå†ç»•Yè½´ï¼Œå†ç»•Zè½´â€ï¼Œè¿™å°±æ˜¯**æ¬§æ‹‰è§’**çš„åŸºæœ¬æ€æƒ³ã€‚
- æ¬§æ‹‰è§’ç”¨**ä¸‰ä¸ªè§’åº¦**ï¼ˆé€šå¸¸æ˜¯ yawã€pitchã€rollï¼‰æ¥è¡¨ç¤ºä¸€ä¸ªç‰©ä½“çš„ç©ºé—´å§¿æ€ã€‚

### å¸¸è§å®šä¹‰æ–¹å¼ï¼š
- **Z-Y-Xé¡ºåº**ï¼ˆèˆªç©ºèˆªå¤©å¸¸ç”¨ï¼‰ï¼š
  - **Roll**ï¼šç»•Xè½´æ—‹è½¬ï¼ˆç¿»æ»šï¼‰
  - **Pitch**ï¼šç»•Yè½´æ—‹è½¬ï¼ˆä¿¯ä»°ï¼‰
  - **Yaw**ï¼šç»•Zè½´æ—‹è½¬ï¼ˆåèˆªï¼‰

Z-Y-Xæ—‹è½¬é¡ºåºï¼šå…ˆ **Yaw** â†’ å† **Pitch** â†’ æœ€å **Roll**

### æ¬§æ‹‰è§’æ—‹è½¬è¿‡ç¨‹:

ç”¨ä¸€ä¸ªä¸‰æ­¥è¿‡ç¨‹æè¿°ï¼š
1. **ç¬¬ä¸€æ­¥ï¼šç»•Zè½´æ—‹è½¬ $\gamma$ï¼ˆYawï¼‰**
2. **ç¬¬äºŒæ­¥ï¼šç»•Yè½´æ—‹è½¬ $\beta$ï¼ˆPitchï¼‰**
3. **ç¬¬ä¸‰æ­¥ï¼šç»•Xè½´æ—‹è½¬ $\alpha$ï¼ˆRollï¼‰**

æœ€ç»ˆçš„æ—‹è½¬çŸ©é˜µä¸ºï¼š

$$
R = R_x(\alpha) \cdot R_y(\beta) \cdot R_z(\gamma)
$$

> æ³¨ï¼šæ—‹è½¬çš„å®é™…é¡ºåºæ˜¯ä»å³å¾€å·¦ä¹˜ï¼

### å’Œæ—‹è½¬çŸ©é˜µçš„å…³ç³»

æ¯ä¸ªè½´çš„åŸºæœ¬æ—‹è½¬çŸ©é˜µä¸ºï¼š

- ç»•Xè½´ï¼ˆRollï¼‰ï¼š
  $$
  R_x(\alpha) = \begin{bmatrix}
  1 & 0 & 0 \\
  0 & \cos\alpha & -\sin\alpha \\
  0 & \sin\alpha & \cos\alpha
  \end{bmatrix}
  $$

- ç»•Yè½´ï¼ˆPitchï¼‰ï¼š
  $$
  R_y(\beta) = \begin{bmatrix}
  \cos\beta & 0 & \sin\beta \\
  0 & 1 & 0 \\
  -\sin\beta & 0 & \cos\beta
  \end{bmatrix}
  $$

- ç»•Zè½´ï¼ˆYawï¼‰ï¼š
  $$
  R_z(\gamma) = \begin{bmatrix}
  \cos\gamma & -\sin\gamma & 0 \\
  \sin\gamma & \cos\gamma & 0 \\
  0 & 0 & 1
  \end{bmatrix}
  $$

*å°å°çš„æé—®ç¯èŠ‚*ï¼šæªå£åæ ‡ç³»åˆ°ç›¸æœºåæ ‡ç³»çš„è½¬æ¢æŒ‰ç…§æ¬§æ‹‰è§’çš„å½¢å¼åº”è¯¥æ€ä¹ˆè½¬å‘¢ï¼Ÿ

## ä¸‰ã€ä»€ä¹ˆæ˜¯æ—‹è½¬å‘é‡ï¼ŸğŸ¤”

æ—‹è½¬å‘é‡æ˜¯ä¸€ç§**ç®€æ´è¡¨ç¤ºç©ºé—´æ—‹è½¬**çš„æ–¹å¼ï¼Œå®ƒå°†ä¸€ä¸ªæ—‹è½¬æ‹†è§£ä¸ºï¼š

- ä¸€æ ¹æ—‹è½¬è½´ + ä¸€ä¸ªæ—‹è½¬è§’åº¦  
- å¹¶å°†ä¸¤è€…åˆå¹¶æˆä¸€ä¸ª**ä¸‰ç»´å‘é‡**

### å®šä¹‰

æ—‹è½¬å‘é‡ $\vec{r}$ æ˜¯ä¸€ä¸ªä¸‰ç»´å‘é‡ï¼Œå®šä¹‰å¦‚ä¸‹ï¼š

$$
\vec{r} = \theta \cdot \hat{u}
$$

- $\theta$ï¼šç»•è½´æ—‹è½¬çš„è§’åº¦ï¼ˆå¼§åº¦ï¼‰
- $\hat{u}$ï¼šå•ä½æ—‹è½¬è½´ï¼ˆ$\|\hat{u}\| = 1$ï¼‰
- $\vec{r}$ çš„æ–¹å‘æ˜¯æ—‹è½¬è½´ï¼Œæ¨¡é•¿æ˜¯æ—‹è½¬è§’åº¦


### å’Œæ—‹è½¬çŸ©é˜µçš„è½¬æ¢ï¼ˆRodrigues å…¬å¼ï¼‰

ç»™å®šæ—‹è½¬å‘é‡ $\vec{r} = \theta \cdot \hat{u}$ï¼Œå¯¹åº”çš„æ—‹è½¬çŸ©é˜µä¸ºï¼š

$$
R = I + \sin\theta \cdot [\hat{u}]_\times + (1 - \cos\theta) \cdot [\hat{u}]_\times^2
$$

å…¶ä¸­ï¼š

- $I$ æ˜¯å•ä½çŸ©é˜µ  
- $[\hat{u}]_\times$ æ˜¯**æ—‹è½¬è½´çš„å‰ä¹˜çŸ©é˜µ**ï¼ˆåå¯¹ç§°çŸ©é˜µï¼‰ï¼š

$$
[\hat{u}]_\times =
\begin{bmatrix}
0 & -u_z & u_y \\
u_z & 0 & -u_x \\
-u_y & u_x & 0
\end{bmatrix}
$$

> åˆ«æ…Œï¼Œç¬”è€…ä¹Ÿä¸æ€ä¹ˆç†è§£ï¼Œè¿˜å¥½opencvæœ‰Rodrigueså‡½æ•° ğŸ¥¹

### å’Œå››å…ƒæ•°çš„è½¬æ¢

ä»æ—‹è½¬å‘é‡ $\vec{r} = \theta \cdot \hat{u}$ å¾—åˆ°å››å…ƒæ•°ï¼š

$$
q = \left[\cos\left(\frac{\theta}{2}\right),\ \hat{u} \cdot \sin\left(\frac{\theta}{2}\right)\right]
$$

è¿™çœŸçš„å¥½ç®€æ´~ï¼Œè¦æ˜¯æ‰€æœ‰å…¬å¼éƒ½è¿™ä¹ˆ**æ¸…çˆ½**å°±å¥½äº†ğŸ˜­
